---
applyTo: "src/**/*.ts, test/**/*.ts"
description: これはプロジェクトのTypeScriptコードスタイルを説明するファイルです
---

このドキュメントは、本プロジェクトにおける核となる開発哲学、プロセス、およびコーディング規約を定義します。コーディングエージェントは、いかなる時もこれらのガイドラインを厳格に遵守することが求められます。この哲学は、和田卓人（t-wada）氏が提唱するテスト駆動開発（TDD）の教えに強く影響を受けています。

## 1. 基本哲学: テスト駆動
- **テストが開発を駆動する:** すべてのプロダクションコードは、失敗するテストをパスさせるためだけに書かれます。テストは後付けの作業ではありません。それ自身が仕様書であり、設計の駆動役です。
- **リファクタリングへの自信:** 包括的なテストスイートは我々のセーフティネットです。これにより、私たちは恐れることなく継続的にコードベースのリファクタリングと改善を行えます。
- **テスト容易性は良い設計に等しい:** コードがテストしにくい場合、それは悪い設計の兆候です。エージェントは、テスト容易性の高いコード作成を最優先しなければなりません。それは自然と、疎結合で凝集度の高いアーキテクチャにつながります。

## 2. 開発サイクル: レッド・グリーン・リファクタリング・コミット
エージェントは、いかに小さな変更であっても、必ずこの反復的なサイクルに従わなければなりません。コードを生成する際は、現在どのフェーズにいるのかを明示してください。

### フェーズ1: レッド - 失敗するテストを書く
- **目的:** これから何を達成するのかを明確に定義する。
- **行動:** 実装コードを書く前に、これから実装したい単一の機能に対する、具体的で失敗するテストを一つ作成する。
- **条件:** 対応する実装がまだ存在しないため、このテストは必ず失敗（**レッド**）しなければならない。

### フェーズ2: グリーン - テストをパスさせる
- **目的:** テストで示された要件を満たす。
- **行動:** 失敗したテストをパスさせるために必要な、**最小限のコード**を記述する。
- **条件:** この段階で余分な機能を追加しないこと。コードの美しさは追求せず、ただテストをパス（**グリーン**）させることだけを考える。

### フェーズ3: リファクタリング - 設計を改善する
- **目的:** テストが通っている状態を維持しながら、コードの品質を向上させる。
- **行動:** テストが成功しているという安全な状態で、コードの内部構造を改善する。これには以下の作業が含まれるが、これに限定されない。
    - 重複の排除（DRY原則）
    - 命名の明確化
    - 複雑なロジックの単純化
    - 後述のコーディング規約がすべて満たされていることの確認
- **条件:** リファクタリングの全プロセスを通じて、すべてのテストは**グリーン**の状態を維持しなければならない。

### フェーズ4: コミット - 進捗を保存する
- **目的:** 正常に動作する小さな機能単位を、安全なバージョンとして記録する。
- **行動:** リファクタリングが完了し、全テストがグリーンであることを最終確認したら、`git add .` を実行して変更をステージングする。これは、次の機能開発へ進む前の安定したチェックポイントとなる。
- **条件:** このサイクルで実装された変更が、一つの意味のあるまとまりとして完結していること。コミットメッセージもその内容を簡潔に表現すること。

## 3. 厳格なコーディング規約と禁止事項

### 【最重要】ハードコードの絶対禁止
いかなる形式のハードコードも固く禁じます。

- **マジックナンバー:** 数値リテラルをロジック内に直接記述してはならない。意味のある名前の定数を定義すること。
  - *悪い例:* `if (age > 20)`
  - *良い例:* `const ADULT_AGE = 20; if (age > ADULT_AGE)`
- **設定値:** APIキー、URL、ファイルパス、その他の環境設定は、必ず設定ファイル（`.env`など）や環境変数から読み込むこと。ソースコード内に直接記述してはならない。
- **ユーザー向け文字列:** UIに表示するテキスト、ログ、エラーメッセージなどは、メンテナンスと国際化を容易にするため、定数や言語ファイルで管理すること。

### その他の主要な規約
- **単一責任の原則 (SRP):** 一つのモジュール、クラス、関数は、機能の一部分に対してのみ責任を持つべきである。
- **DRY (Don't Repeat Yourself):** コードの重複は絶対に避けること。共通ロジックは抽象化し、再利用する。
- **明確で意図の伝わる命名:** 変数名や関数名は、その目的と意図が明確に伝わるように命名する。
- **ガード節 / 早期リターン:** 深くネストした`if-else`構造を避け、早期リターンを積極的に利用する。
- **セキュリティ第一:** ユーザーからの入力は常に信頼しないこと。一般的な脆弱性（XSS、SQLインジェクション等）を防ぐため、入力のサニタイズと出力のエンコードを徹底する。
